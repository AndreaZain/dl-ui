<template>
  <style>
    .text-rotate {
      -webkit-writing-mode: tb-rl;
      -ms-writing-mode: tb-rl;
      -moz-writing-mode: tb-rl;
      -o-writing-mode: tb-rl;
      writing-mode: tb-rl;
      -webkit-transform: rotate(-180deg);
      -ms-transform: rotate(-180deg);
      -moz-transform: rotate(-180deg);
      -o-transform: rotate(-180deg);
      transform: rotate(-180deg);
    }

    .text-right {
      text-align: right;
    }

    .text-bold {
      font-weight: 600 !important;
    }

    .hide {
      display: none;
    }

    .v-center {
      vertical-align: middle !important;
    }

    .flex-center {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .nester {
      border-bottom: none !important;
      border-top: none !important;
    }
  </style>

  <au-input-form title="Budget Cashflow Divisi">
    <au-autocomplete
      value.bind="division"
      error.bind="error.division"
      label="Division"
      loader.bind="divisionLoader"
      text="Name"
      placeholder="Cari Divisi"
      options.bind="controlOptions"
    >
    </au-autocomplete>
    <au-datepicker
      label="Periode"
      value.bind="date"
      error.bind="error.date"
      options.bind="controlOptions"
    >
    </au-datepicker>

    <div class="form-group">
      <div class="col-sm-6"></div>
      <div class="col-sm-3">
        <button click.delegate="search()" class="btn btn-success">Cari</button>
        <button click.delegate="reset()" class="btn btn-success">Reset</button>
      </div>
    </div>
    <div if.bind="!isEmpty" class="btn-group pull-left">
      <a click.delegate="printXls()" class="btn btn-primary">Cetak Excel</a>
      <a click.delegate="printPdf()" class="btn btn-info">Cetak Pdf</a>
    </div>

    <br /><br />

    <div if.bind="!isEmpty" class="table-responsive">
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th colspan="4" rowspan="2">KETERANGAN</th>
            <th rowspan="2">CURRENCY</th>
            <th colspan="3" repeat.for="column of columns">${column}</th>
          </tr>
          <tr>
            <th repeat.for="column of subColumns">${column}</th>
          </tr>
        </thead>
        <tbody>
          <tr repeat.for="row of rows">
            <!-- Contoh: Kegiatan Operasional -->
            <td
              if.bind="row.IsUseSection"
              rowspan="${row.SectionRows || 1}"
              class="v-center"
            >
              <span class="text-rotate text-bold"
                >${row.CashflowType.Name}</span
              >
            </td>

            <!-- Contoh: Cash In -->
            <td
              if.bind="row.IsUseGroup"
              rowspan="${row.GroupRows || 1}"
              class="v-center"
            >
              <span class="text-rotate text-bold">${row.TypeName}</span>
            </td>

            <!-- Contoh: Pendapatan Operasional: -->
            <td
              if.bind="row.CashflowCategory && row.CashflowCategory.Id"
              colspan="2"
              class="text-bold"
            >
              ${row.CashflowCategory.Name}
            </td>

            <!-- Contoh: Penjualan Export -->
            <td
              if.bind="row.CashflowSubCategory && row.CashflowSubCategory.Id"
              class="nester"
            ></td>
            <!-- <td
              if.bind="row.CashflowSubCategory && row.CashflowSubCategory.Id"
              colspan="${!row.CashflowSubCategory.IsReadOnly && row.IsShowSubCategoryLabel ? 1 : 2}"
            > -->
            <!-- <td
              if.bind="row.CashflowSubCategory && row.CashflowSubCategory.Id"
              colspan="${!row.CashflowSubCategory.IsReadOnly  ? 1 : 2}"
            > -->
            <td if.bind="row.CashflowSubCategory && row.CashflowSubCategory.Id">
              <!-- <span class="${!row.IsShowSubCategoryLabel ? 'hide' : ''}"> -->
              <span> ${row.CashflowSubCategory.Name} </span>
            </td>

            <!-- Contoh: Total Penerimaan Kegiatan Operasional -->
            <td if.bind="row.IsSummary" colspan="2" class="text-bold">
              <span class="${!row.IsShowSummaryLabel ? 'hide' : ''}">
                ${row.SummaryLabel}
              </span>
            </td>

            <!-- Contoh: Surplus/Deficit-Kas dari Kegiatan Investasi -->
            <td if.bind="row.IsDifference" colspan="3" class="text-bold">
              <span class="${!row.IsShowDifferenceLabel ? 'hide' : ''}">
                ${row.DifferenceLabel}
              </span>
            </td>

            <!-- Contoh: Saldo Awal Kas -->
            <!-- <td
              if.bind="row.IsSummaryBalance"
              colspan="${!row.IsReadOnly && row.IsSummaryBalance ? 3 : 4}"
              class="text-bold"
            >
              <span class="${!row.IsShowSummaryBalance ? 'hide' : ''}">
                ${row.SummaryBalanceLabel}
              </span>
            </td> -->

            <!-- Contoh: SURPLUS/DEFISIT KAS -->
            <!-- <td if.bind="row.IsShowSummary" colspan="4" class="text-bold">
              <span class="${!row.IsShowSummaryLabel ? 'hide' : ''}">
                ${row.SummaryLabel}
              </span>
            </td> -->

            <!-- Kosong jika hanya label -->
            <td
              if.bind="row.IsLabelOnly && !row.Items"
              colspan="${columns.length * 3 + 1}"
            ></td>

            <!-- Field mata uang -->
            <td if.bind="row.Currency">
              <au-textbox
                value.bind="row.Currency.Code ? row.Currency.Code : '-'"
                read-only.bind="true"
              >
              </au-textbox>
            </td>

            <!-- Fields nominal, nominal valas dan actual -->
            <td
              if.bind="!row.IsLabelOnly && row.Items"
              repeat.for="item of row.Items"
            >
              <au-numeric
                value.bind="item.DivisionNominal"
                format="0,000.00"
                read-only.bind="true"
              >
              </au-numeric>
            </td>
            <td
              if.bind="!row.IsLabelOnly && row.Items"
              repeat.for="item of row.Items"
            >
              <au-numeric
                value.bind="item.DivisionCurrencyNominal"
                format="0,000.00"
                read-only.bind="true"
              >
              </au-numeric>
            </td>

            <td
              if.bind="!row.IsLabelOnly && row.Items"
              repeat.for="item of row.Items"
            >
              <au-numeric
                value.bind="item.DivisionActual"
                format="0,000.00"
                read-only.bind="true"
              >
              </au-numeric>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </au-input-form>
</template>
